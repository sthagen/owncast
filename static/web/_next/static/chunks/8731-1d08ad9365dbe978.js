(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8731],{92093:function(e,t,a){"use strict";a.r(t),a.d(t,{ChatContainer:function(){return eU}});var s,r,n,o,l,i=a(85893),c=a(26246),d=a(67294),h=a(4511),u=a(28997),m=a(45761),g=a.n(m),_=a(94184),p=a.n(_),x=a(94199),C=a(4480),f=a(5152),j=a.n(f),b=a(63108),N=a(41366),E=a(4693);class v extends E.M{match(e){let{highlightString:t}=this.options;if(!t)return null;let a=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\s/g,"\\s"),s=a.normalize("NFD").replace(/[\u0300-\u036f]/g,""),r=a;a!==s&&(r="(?:".concat(a,")|(?:").concat(s,")"));let n=e.match(RegExp(r,"ui"));return n?{index:n.index,length:n[0].length,match:n[0],valid:!0}:null}replaceWith(e,t){let{key:a}=t;return d.createElement("mark",{key:a},e)}asTag(){return"mark"}}var M=a(75774),w=a.n(M),y=a(63516);function T(e){let t=new Date(e);if(Number.isNaN(t))return"";let a=(0,y.Xb)(e);if(a>=1){let e=t.toLocaleDateString("en-US",{dateStyle:"medium"});return"".concat(e," at ").concat(t.toLocaleTimeString())}return"".concat(t.toLocaleTimeString())}var k=a(44974),S=a(73295),G=a.n(S);let A=e=>{let{badge:t,userColor:a,title:s}=e;return(0,i.jsx)("span",{style:{color:"var(--theme-color-users-".concat(a,")")},className:G().badge,title:s,children:t})},O=j()(()=>Promise.all([a.e(2074),a.e(7719)]).then(a.t.bind(a,27719,23)),{loadableGenerated:{webpack:()=>[27719]},ssr:!1}),D=e=>{let{userColor:t}=e;return(0,i.jsx)(A,{badge:(0,i.jsx)(O,{}),userColor:t,title:"Authenticated"})},B=j()(()=>Promise.all([a.e(2074),a.e(710)]).then(a.t.bind(a,20710,23)),{loadableGenerated:{webpack:()=>[20710]},ssr:!1}),F=e=>{let{userColor:t}=e;return(0,i.jsx)(A,{badge:(0,i.jsx)(B,{}),userColor:t,title:"Moderator"})},P=j()(()=>Promise.all([a.e(2074),a.e(6133)]).then(a.t.bind(a,56133,23)),{loadableGenerated:{webpack:()=>[56133]},ssr:!1}),U=e=>{let{userColor:t}=e;return(0,i.jsx)(A,{badge:(0,i.jsx)(P,{}),userColor:t,title:"Bot"})},L=j()(()=>Promise.all([a.e(173),a.e(5874),a.e(4931),a.e(5402),a.e(1382),a.e(4041),a.e(3698),a.e(3013),a.e(4398),a.e(8091),a.e(8869)]).then(a.bind(a,39991)).then(e=>e.ChatModerationActionMenu),{loadableGenerated:{webpack:()=>[39991]},ssr:!1}),I=e=>{let{children:t,user:a}=e,{displayName:s,createdAt:r}=a,n="".concat(s," first joined ").concat(T(r));return(0,i.jsx)(x.Z,{title:n,placement:"topLeft",mouseEnterDelay:1,children:t})},R=e=>{let{message:t,highlightString:a,showModeratorMenu:s,sentBySelf:r,sameUserAsLast:n,isAuthorModerator:o,isAuthorAuthenticated:l,isAuthorBot:c}=e,{id:d,body:h,user:u,timestamp:m}=t,{id:g,displayName:_,displayColor:f}=u,j=(0,C.sJ)(k.FI),E="var(--theme-color-users-".concat(f,")"),M="Sent ".concat(T(m)),y=[];return o&&y.push((0,i.jsx)(F,{userColor:f},"mod")),l&&y.push((0,i.jsx)(D,{userColor:f},"auth")),c&&y.push((0,i.jsx)(U,{userColor:f},"bot")),(0,i.jsx)("div",{className:p()(w().messagePadding,n&&w().messagePaddingCollapsed,"chat-message_user"),children:(0,i.jsxs)("div",{className:p()(w().root,{[w().ownMessage]:r}),style:{borderColor:E},children:[(0,i.jsx)("div",{className:w().background,style:{color:E}}),(0,i.jsx)(I,{user:u,children:(0,i.jsxs)("div",{className:n?w().repeatUser:w().user,style:{color:E},children:[(0,i.jsx)("span",{className:w().userName,children:_}),(0,i.jsx)("span",{className:w().userBadges,children:y})]})}),(0,i.jsx)(x.Z,{title:M,mouseEnterDelay:1,children:(0,i.jsx)(b.wZ,{className:w().message,content:h,matchers:[new N.xc("url",{customTLDs:["online"]}),new v("highlight",{highlightString:a})]})}),s&&(0,i.jsx)("div",{className:w().modMenuWrapper,children:(0,i.jsx)(L,{messageID:d,accessToken:j,userID:g,userDisplayName:_})})]})})};var W=a(55241),V=a(61512),H=a.n(V),Z=a(91036),J=a.n(Z),z=a(30323),K=a.n(z),X=a(14866),q=a.n(X);let Y=j()(()=>Promise.all([a.e(7741),a.e(344)]).then(a.bind(a,20344)).then(e=>e.EmojiPicker),{loadableGenerated:{webpack:()=>[20344]},ssr:!1}),$=j()(()=>Promise.all([a.e(2074),a.e(3366)]).then(a.t.bind(a,73366,23)),{loadableGenerated:{webpack:()=>[73366]},ssr:!1}),Q=j()(()=>Promise.all([a.e(2074),a.e(2348)]).then(a.t.bind(a,92348,23)),{loadableGenerated:{webpack:()=>[92348]},ssr:!1}),ee=new(K()),et=(e,t)=>{let a="";if(t>10||null===e)return a;switch(e.nodeType){case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:a=e.nodeValue;break;case Node.ELEMENT_NODE:switch(e.tagName.toLowerCase()){case"img":a=e.getAttribute("alt")||"";break;case"br":a="\n";break;case"strong":case"b":a="**";for(let s=0;s<e.childNodes.length;s+=1)a+=et(e.childNodes[s],t+1);a+="**";break;case"em":case"i":a="*";for(let s=0;s<e.childNodes.length;s+=1)a+=et(e.childNodes[s],t+1);a+="*";break;case"p":a="\n";for(let s=0;s<e.childNodes.length;s+=1)a+=et(e.childNodes[s],t+1);break;case"a":case"span":case"div":for(let s=0;s<e.childNodes.length;s+=1)a+=et(e.childNodes[s],t+1);break;case"script":case"style":break;default:a=e.textContent}}return a},ea=e=>{let t=et(e,0).replace(/^\s+/,"").replace(/\s+$/,"").replace(/\n([^\n])/g,"  \n$1");return t},es=e=>{let{defaultText:t,enabled:a,focusInput:s}=e,[r,n]=(0,d.useState)(null==t?void 0:t.length),o=(0,C.sJ)(k.Gt),l=(0,d.useRef)(t||""),c=d.createRef(),[h,m]=(0,d.useState)([]),[,g]=(0,d.useReducer)(e=>e+1,0),_=()=>{let e=ea(c.current);return ee.countGraphemes(e)},x=()=>{if(!o){console.log("websocketService is not defined");return}let e=ea(c.current),t=ee.countGraphemes(e);0===t||t>300||(o.send({type:u.C.CHAT,body:e}),l.current="",n(0),g())},f=e=>{let t=l.current+e;l.current=t,g()};(0,d.useEffect)(()=>{s&&document.getElementById("chat-input-content-editable").focus()},[]);let j=async()=>{try{let e=await fetch("/api/emoji"),t=await e.json();m(t),t.forEach(e=>{let t=document.createElement("link");t.href=e.url,t.rel="preload",t.as="image",document.head.appendChild(t)})}catch(e){console.error("cannot fetch custom emoji",e)}};return(0,d.useEffect)(()=>{j()},[]),(0,i.jsx)("div",{id:"chat-input",className:q().root,children:(0,i.jsxs)("div",{className:p()(q().inputWrap,r>300&&q().maxCharacters),children:[(0,i.jsx)(H(),{id:"chat-input-content-editable",html:l.current,placeholder:a?"Send a message to chat":"Chat is disabled",disabled:!a,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||e.metaKey||e.ctrlKey||e.altKey||(e.preventDefault(),x())},onChange:e=>{let t=J()(e.target.value,{allowedTags:["b","i","em","strong","a","br","p","img"],allowedAttributes:{img:["class","alt","title","src"]},allowedClasses:{img:["emoji"]},transformTags:{h1:"p",h2:"p",h3:"p"}});l.current!==t&&(l.current=t),n(_())},style:{width:"100%"},role:"textbox","aria-label":"Chat text input",innerRef:c}),a&&(0,i.jsxs)("div",{style:{display:"flex",paddingLeft:"5px"},children:[(0,i.jsx)(W.Z,{content:(0,i.jsx)(Y,{customEmoji:h,onEmojiSelect:e=>{n(_()+1),f(e)},onCustomEmojiSelect:(e,t)=>{let a='<img src="'.concat(t,'" alt=":').concat(e,':" title=":').concat(e,':" class="emoji" />');n(_()+e.length+2),f(a)}}),trigger:"click",placement:"topRight",children:(0,i.jsx)("button",{type:"button",className:q().emojiButton,title:"Emoji picker button",children:(0,i.jsx)(Q,{})})}),(0,i.jsx)("button",{type:"button",className:q().sendButton,title:"Send message Button",onClick:x,children:(0,i.jsx)($,{})})]})]})})};var er=a(71368),en=a.n(er);function eo(){return(eo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}var el=function(e){return d.createElement("svg",eo({xmlns:"http://www.w3.org/2000/svg",width:500,height:500,viewBox:"0 0 132.292 132.292"},e),s||(s=d.createElement("linearGradient",{id:"moderator_svg__a",x1:432.851,x2:464.644,y1:49.977,y2:49.977,gradientUnits:"userSpaceOnUse"},d.createElement("stop",{offset:0,stopColor:"#2087e2"}),d.createElement("stop",{offset:1,stopColor:"#b63fff"}))),r||(r=d.createElement("path",{fill:"url(#moderator_svg__a)",d:"M438.672 34.08h20.151a5.82 5.82 45 0 1 5.82 5.821v20.151a5.82 5.82 135 0 1-5.82 5.821h-20.15a5.82 5.82 45 0 1-5.822-5.82V39.9a5.82 5.82 135 0 1 5.821-5.82z",transform:"matrix(4.16112 0 0 4.16112 -1801.146 -141.814)"})),n||(n=d.createElement("path",{fill:"#1d1535",fillOpacity:.335,d:"M121.11 29.551c-6.93 47.444-30.074 104.618-77.642 79.674l25.83 23.067h38.772c13.377 0 24.22-10.845 24.22-24.222V40.864z"})),o||(o=d.createElement("path",{fill:"#e2e8f0",fillOpacity:.306,d:"M66.775 13.257s-7.129 57.999-.63 99.312c6.565 41.724-81.568-74.394-49.619-79.203 31.949-4.809 50.249-20.11 50.249-20.11z"})),l||(l=d.createElement("path",{fill:"none",stroke:"#fff",strokeLinejoin:"round",strokeWidth:2,d:"M435.995 42.072c6.797.447 12.753-4.806 12.753-4.806s5.955 5.253 12.752 4.806c-.581 12.745-7.495 20.586-12.752 20.628-5.188.042-12.172-7.883-12.753-20.628z",transform:"matrix(4.16112 0 0 4.16112 -1801.146 -141.814)"})))};let ei=()=>(0,i.jsxs)("div",{className:en().chatModerationNotification,children:[(0,i.jsx)(el,{className:en().icon}),"You are now a moderator."]});var ec=a(61120),ed=a.n(ec);let eh=e=>{let{message:{body:t,user:{displayName:a}},highlightString:s}=e;return(0,i.jsxs)("div",{className:p()([ed().chatSystemMessage,"chat-message_system"]),children:[(0,i.jsx)("div",{className:ed().user,children:(0,i.jsx)("span",{className:ed().userName,children:a})}),(0,i.jsx)(b.wZ,{className:ed().message,content:t,matchers:[new N.xc("url",{customTLDs:["online"]}),new v("highlight",{highlightString:s})]})]})};var eu=a(56654),em=a.n(eu);let eg=j()(()=>Promise.all([a.e(2074),a.e(8725)]).then(a.t.bind(a,8725,23)),{loadableGenerated:{webpack:()=>[8725]},ssr:!1}),e_=e=>{let{isAuthorModerator:t,userColor:a,displayName:s}=e;return(0,i.jsxs)("div",{className:em().root,children:[(0,i.jsxs)("span",{style:{color:"var(--theme-color-users-".concat(a,")")},children:[(0,i.jsx)("span",{className:em().icon,children:(0,i.jsx)(eg,{})}),(0,i.jsx)("span",{className:em().user,children:s}),t&&(0,i.jsx)("span",{className:em().moderatorBadge,children:(0,i.jsx)(F,{userColor:a})})]}),"joined the chat."]})};var ep=a(71577);let ex=j()(()=>Promise.all([a.e(2074),a.e(437)]).then(a.t.bind(a,20437,23)),{loadableGenerated:{webpack:()=>[20437]},ssr:!1}),eC=e=>{let{onClick:t}=e;return(0,i.jsx)("div",{className:g().toBottomWrap,id:"scroll-to-chat-bottom",children:(0,i.jsx)(ep.Z,{type:"default",style:{color:"currentColor"},icon:(0,i.jsx)(ex,{}),onClick:t,children:"Go to last message"})})};var ef=a(88881),ej=a.n(ef);let eb=e=>{let{body:t}=e;return(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:t},className:ej().chatAction})};var eN=a(71230),eE=a(15746),ev=a(24093),eM=a(31654),ew=a.n(eM);let ey=j()(()=>a.e(9069).then(a.bind(a,49069)),{loadableGenerated:{webpack:()=>[49069]},ssr:!1}),eT=j()(()=>a.e(5584).then(a.bind(a,15584)),{loadableGenerated:{webpack:()=>[15584]},ssr:!1}),ek=j()(()=>a.e(7268).then(a.bind(a,97268)),{loadableGenerated:{webpack:()=>[97268]},ssr:!1}),eS=e=>{let t,{message:a}=e,{body:s,title:r,image:n,link:o,type:l}=a;switch(l.toString()){case"FEDIVERSE_ENGAGEMENT_FOLLOW":t=ey;break;case"FEDIVERSE_ENGAGEMENT_LIKE":t=eT;break;case"FEDIVERSE_ENGAGEMENT_REPOST":t=ek}return(0,i.jsx)("div",{className:p()([ew().follower,"chat-message_social"]),children:(0,i.jsx)("a",{href:o,target:"_blank",rel:"noreferrer",children:(0,i.jsxs)(eN.Z,{wrap:!1,children:[(0,i.jsxs)(eE.Z,{span:6,className:ew().avatarColumn,children:[(0,i.jsx)(ev.C,{src:n,alt:"Avatar",className:ew().avatar,size:"large",children:r.charAt(0).toUpperCase()}),(0,i.jsx)(t,{className:ew().icon})]}),(0,i.jsxs)(eE.Z,{children:[(0,i.jsx)(eN.Z,{className:ew().account,children:r}),(0,i.jsx)(eN.Z,{className:ew().body,dangerouslySetInnerHTML:{__html:s}})]})]})})})};var eG=a(44964),eA=a.n(eG);let eO=j()(()=>Promise.all([a.e(2074),a.e(1668)]).then(a.t.bind(a,51668,23)),{loadableGenerated:{webpack:()=>[51668]},ssr:!1}),eD=e=>{let{message:t}=e,{oldName:a,user:s}=t,{displayName:r,displayColor:n}=s,o="var(--theme-color-users-".concat(n,")");return(0,i.jsxs)("div",{className:eA().nameChangeView,children:[(0,i.jsx)("div",{className:eA().icon,children:(0,i.jsx)(eO,{})}),(0,i.jsxs)("div",{className:eA().nameChangeText,children:[(0,i.jsx)("span",{style:{color:o},children:a}),(0,i.jsx)("span",{className:eA().plain,children:" is now known as "}),(0,i.jsx)("span",{style:{color:o},children:r})]})]})};var eB=a(25449),eF=a(69183);function eP(e){let{user:t}=e,a=new eB.n(t);return a.isModerator}let eU=e=>{let{messages:t,usernameToHighlight:a,chatUserId:s,isModerator:r,showInput:n,height:o,chatAvailable:l,focusInput:m=!0}=e,[_,p]=(0,d.useState)(!1),[x,C]=(0,d.useState)(!1),f=(0,d.useRef)(null),j=(0,d.useRef)(null),b=[],N=1;(0,d.useEffect)(()=>()=>{clearTimeout(j.current)},[]);let E=e=>(0,i.jsx)(eS,{message:e}),v=e=>{let{user:{displayName:t,displayColor:a}}=e,s=eP(e);return(0,i.jsx)(e_,{displayName:t,userColor:a,isAuthorModerator:s})},M=e=>{let{body:t}=e;return(0,i.jsx)(eb,{body:t})},w=e=>{let t=eP(e);return t?(0,i.jsx)(ei,{}):(0,i.jsx)("div",{style:{width:"1px",height:"1px"}})},y=(e,n)=>{var o,l,c;let d=eP(n);return(0,i.jsx)(R,{message:n,showModeratorMenu:r,highlightString:a,sentBySelf:(null===(o=n.user)||void 0===o?void 0:o.id)===s,sameUserAsLast:(b.length<=e&&function(){for(let e=b.length;e<t.length;e+=1){let a=e>0&&N<5&&function(e,t){if(!e||!e.user||t.type!==u.C.CHAT)return!1;let{user:{id:a}}=e;if(a!==t.user.id||!t.timestamp||!e.timestamp)return!1;let s=new Date(t.timestamp).getTime(),r=new Date(e.timestamp).getTime();return!(r-s>4e4)}(t[e],t[e-1]);b.push(a),N=1+(a?N:0)}}(),b[e]),isAuthorModerator:d,isAuthorBot:null===(l=n.user)||void 0===l?void 0:l.isBot,isAuthorAuthenticated:null===(c=n.user)||void 0===c?void 0:c.authenticated},n.id)},T=(e,t)=>{switch(t.type){case u.C.CHAT:return y(e,t);case u.C.NAME_CHANGE:return(0,i.jsx)(eD,{message:t});case u.C.CONNECTED_USER_INFO:return w(t);case u.C.USER_JOINED:return v(t);case u.C.CHAT_ACTION:return M(t);case u.C.SYSTEM:return(0,i.jsx)(eh,{message:t,highlightString:a},t.id);case u.C.FEDIVERSE_ENGAGEMENT_FOLLOW:case u.C.FEDIVERSE_ENGAGEMENT_LIKE:case u.C.FEDIVERSE_ENGAGEMENT_REPOST:return E(t);default:return null}},k=e=>{clearTimeout(j.current),j.current=setTimeout(()=>{var t;null===(t=e.current)||void 0===t||t.scrollTo({top:1/0,left:0,behavior:"auto"}),C(!0)},150),p(!1)};(0,d.useEffect)(()=>{setTimeout(()=>{k(f)},500)},[]);let S=(0,d.useMemo)(()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.OO,{id:"virtuoso",style:{height:o},className:g().virtuoso,ref:f,data:t,itemContent:(e,t)=>T(e,t),initialTopMostItemIndex:t.length-1,followOutput:()=>!!x&&(p(!1),k(f),"smooth"),alignToBottom:!0,atBottomThreshold:70,atBottomStateChange:e=>{C(e),e?p(!1):p(!0)}}),_&&(0,i.jsx)(eC,{onClick:()=>{k(f)}})]}),[t,a,s,r,_,x]);return(0,i.jsx)(h.SV,{fallbackRender:e=>{let{error:t,resetErrorBoundary:a}=e;return(0,i.jsx)(eF.A,{componentName:"ChatContainer",message:t.message,retryFunction:a})},children:(0,i.jsxs)("div",{id:"chat-container",className:g().chatContainer,children:[S,n&&(0,i.jsx)("div",{className:g().chatTextField,children:(0,i.jsx)(es,{enabled:l,focusInput:m})})]})})};eU.defaultProps={showInput:!0,height:"auto"}},88881:function(e){e.exports={chatAction:"ChatActionMessage_chatAction__x9Xsg"}},45761:function(e){e.exports={toBottomWrap:"ChatContainer_toBottomWrap__3V5wa",show:"ChatContainer_show__OBPqg",chatContainer:"ChatContainer_chatContainer__O2lYN",virtuoso:"ChatContainer_virtuoso__OS9Kz",chatTextField:"ChatContainer_chatTextField__OqCGL"}},56654:function(e){e.exports={root:"ChatJoinMessage_root__vuVXa",moderatorBadge:"ChatJoinMessage_moderatorBadge__HF66k",user:"ChatJoinMessage_user__kYpU9",icon:"ChatJoinMessage_icon__TzTHn"}},71368:function(e){e.exports={chatModerationNotification:"ChatModeratorNotification_chatModerationNotification__kgFWe",icon:"ChatModeratorNotification_icon__7FdGg"}},44964:function(e){e.exports={nameChangeView:"ChatNameChangeMessage_nameChangeView__z4WoO",nameChangeText:"ChatNameChangeMessage_nameChangeText__PTEQP",plain:"ChatNameChangeMessage_plain__heTPn",icon:"ChatNameChangeMessage_icon__TWCil"}},31654:function(e){e.exports={follower:"ChatSocialMessage_follower__TyNGH",avatar:"ChatSocialMessage_avatar__QbcNk",avatarColumn:"ChatSocialMessage_avatarColumn__inCWq",body:"ChatSocialMessage_body__aY2Oa",account:"ChatSocialMessage_account__uGSKr",icon:"ChatSocialMessage_icon__fiCk6"}},61120:function(e){e.exports={chatSystemMessage:"ChatSystemMessage_chatSystemMessage__c6XEN",user:"ChatSystemMessage_user__6yHSJ",message:"ChatSystemMessage_message__ySq5g"}},14866:function(e){e.exports={root:"ChatTextField_root__4oUkJ",inputWrap:"ChatTextField_inputWrap__1mAjD",maxCharacters:"ChatTextField_maxCharacters__yGT4s",emojiButton:"ChatTextField_emojiButton__ON_Cu",sendButton:"ChatTextField_sendButton__MOmD4"}},73295:function(e){e.exports={badge:"ChatUserBadge_badge__1EdUp"}},75774:function(e){e.exports={root:"ChatUserMessage_root__79heB",user:"ChatUserMessage_user__xUEp9",repeatUser:"ChatUserMessage_repeatUser__HnoyL",userBadges:"ChatUserMessage_userBadges__L6wat",message:"ChatUserMessage_message__MJ9LD",ownMessage:"ChatUserMessage_ownMessage__d28A3",background:"ChatUserMessage_background__Tfghp",modMenuWrapper:"ChatUserMessage_modMenuWrapper__7fblv",messagePadding:"ChatUserMessage_messagePadding__Xp1F6",messagePaddingCollapsed:"ChatUserMessage_messagePaddingCollapsed__qxN0E"}},22868:function(){},14777:function(){},99830:function(){},70209:function(){}}]);