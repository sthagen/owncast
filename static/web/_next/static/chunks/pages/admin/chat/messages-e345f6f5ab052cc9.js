(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7095],{62433:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/chat/messages",function(){return s(67994)}])},67994:function(e,t,s){"use strict";s.r(t),s.d(t,{OUTCOME_TIMEOUT:function(){return C},default:function(){return Chat}});var a=s(85893),l=s(67294),i=s(2307),n=s(53740),r=s(65400),d=s(94184),o=s.n(d),c=s(58091),u=s(5152),m=s.n(u),h=s(92863),g=s(19120),p=s(94055);let b=m()(()=>Promise.resolve().then(s.t.bind(s,29918,23)),{loadableGenerated:{webpack:()=>[29918]},ssr:!1}),w=m()(()=>Promise.resolve().then(s.t.bind(s,84645,23)),{loadableGenerated:{webpack:()=>[84645]},ssr:!1}),x=m()(()=>Promise.resolve().then(s.t.bind(s,37431,23)),{loadableGenerated:{webpack:()=>[37431]},ssr:!1}),f=m()(()=>Promise.resolve().then(s.t.bind(s,42461,23)),{loadableGenerated:{webpack:()=>[42461]},ssr:!1}),MessageVisiblityToggle=e=>{let{isVisible:t,message:s,setMessage:i}=e;if(!s||(0,g.Qr)(s))return null;let n=null,[d,o]=(0,l.useState)(0),{id:c}=s||{},resetOutcome=()=>{n=setTimeout(()=>{o(0)},3e3)};(0,l.useEffect)(()=>()=>{clearTimeout(n)});let updateChatMessage=async()=>{clearTimeout(n),o(0);let e=await (0,h.rQ)(h.hn,{auth:!0,method:"POST",data:{visible:!t,idArray:[c]}});e.success&&"changed"===e.message?(i({...s,visible:!t}),o(1)):(i({...s,visible:t}),o(-1)),resetOutcome()},u=(0,a.jsx)(x,{style:{color:"transparent"}});return d&&(u=d>0?(0,a.jsx)(x,{style:{color:"var(--ant-success)"}}):(0,a.jsx)(f,{style:{color:"var(--ant-warning)"}})),(0,a.jsxs)("div",{className:"toggle-switch ".concat(t?"":"hidden"),children:[(0,a.jsx)("span",{className:"outcome-icon",children:u}),(0,a.jsx)(p.default,{title:"Click to ".concat(t?"hide":"show"," this message"),placement:"topRight",children:(0,a.jsx)(r.default,{shape:"circle",size:"small",type:"text",icon:t?(0,a.jsx)(b,{}):(0,a.jsx)(w,{}),onClick:updateChatMessage})})]})};var y=s(48560),v=s(15578);let{Title:k}=n.default,N=m()(()=>Promise.resolve().then(s.t.bind(s,37431,23)),{loadableGenerated:{webpack:()=>[37431]},ssr:!1}),j=m()(()=>Promise.resolve().then(s.t.bind(s,42461,23)),{loadableGenerated:{webpack:()=>[42461]},ssr:!1});function createUserNameFilters(e){let t=e.reduce((e,t)=>{let s=t.user.id;return e.some(e=>e.text===s)||e.push({text:s,value:s}),e},[]);return t.sort((e,t)=>{let s=e.text.toUpperCase(),a=t.text.toUpperCase();return s<a?-1:s>a?1:0})}let C=3e3;function Chat(){let[e,t]=(0,l.useState)([]),[s,n]=(0,l.useState)([]),[d,u]=(0,l.useState)(!1),[m,p]=(0,l.useState)(null),[b,w]=(0,l.useState)(""),x=null,f=null,getInfo=async()=>{try{let e=await (0,h.rQ)(h.WE,{auth:!0});(0,g.Qr)(e)?t([]):t(e)}catch(e){console.log("==== error",e)}};(0,l.useEffect)(()=>(getInfo(),f=setInterval(()=>{getInfo()},h.NE),()=>{clearTimeout(x),clearTimeout(f)}),[]);let v=createUserNameFilters(e),updateMessage=s=>{let a=e.findIndex(e=>e.id===s.id);e.splice(a,1,s),t([...e])},resetBulkOutcome=()=>{x=setTimeout(()=>{p(null),w("")},C)},handleSubmitBulk=async l=>{u(!0);let i=await (0,h.rQ)(h.hn,{auth:!0,method:"POST",data:{visible:l,idArray:s}});if(i.success&&"changed"===i.message){p((0,a.jsx)(N,{})),resetBulkOutcome();let i=[...e];s.map(t=>{let s=i.findIndex(e=>e.id===t),a={...e[s],visible:l};return i.splice(s,1,a),null}),t(i),n([])}else p((0,a.jsx)(j,{})),resetBulkOutcome();u(!1)},T=[{title:"Time",dataIndex:"timestamp",key:"timestamp",className:"timestamp-col",defaultSortOrder:"descend",render:e=>{let t=new Date(e);return(0,c.Z)(t,"PP pp")},sorter:(e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime(),width:90},{title:"User",dataIndex:"user",key:"user",className:"name-col",filters:v,onFilter:(e,t)=>t.user.id===e,sorter:(e,t)=>e.user.displayName.localeCompare(t.user.displayName),sortDirections:["ascend","descend"],ellipsis:!0,render:e=>{let{displayName:t}=e;return(0,a.jsx)(y.Z,{user:e,children:t})},width:110},{title:"Message",dataIndex:"body",key:"body",className:"message-col",width:320,render:e=>(0,a.jsx)("div",{className:"message-contents",dangerouslySetInnerHTML:{__html:e}})},{title:"",dataIndex:"hiddenAt",key:"hiddenAt",className:"toggle-col",filters:[{text:"Visible messages",value:!0},{text:"Hidden messages",value:!1}],onFilter:(e,t)=>t.visible===e,render:(e,t)=>(0,a.jsx)(MessageVisiblityToggle,{isVisible:!e,message:t,setMessage:updateMessage}),width:30}],S=o()({"bulk-editor":!0,active:s.length});return(0,a.jsxs)("div",{className:"chat-messages",children:[(0,a.jsx)(k,{children:"Chat Messages"}),(0,a.jsx)("p",{children:"Manage the messages from viewers that show up on your stream."}),(0,a.jsxs)("div",{className:S,children:[(0,a.jsx)("span",{className:"label",children:"Check multiple messages to change their visibility to: "}),(0,a.jsx)(r.default,{type:"primary",size:"small",shape:"round",className:"button",loading:"show"===b&&d,icon:"show"===b&&m,disabled:!s.length||b&&"show"!==b,onClick:()=>{w("show"),handleSubmitBulk(!0)},children:"Show"}),(0,a.jsx)(r.default,{type:"primary",size:"small",shape:"round",className:"button",loading:"hide"===b&&d,icon:"hide"===b&&m,disabled:!s.length||b&&"hide"!==b,onClick:()=>{w("hide"),handleSubmitBulk(!1)},children:"Hide"})]}),(0,a.jsx)(i.Z,{size:"small",className:"table-container",pagination:{defaultPageSize:100,showSizeChanger:!0},scroll:{y:540},rowClassName:e=>e.hiddenAt?"hidden":"",dataSource:e,columns:T,rowKey:e=>e.id,rowSelection:{selectedRowKeys:s,onChange:e=>{n(e)}}})]})}Chat.getLayout=function(e){return(0,a.jsx)(v.l,{page:e})}}},function(e){e.O(0,[5596,1130,4104,9403,1024,3942,971,6697,1664,1749,1700,2122,7752,5891,2891,4749,6627,8966,8091,5938,686,5578,2019,9774,2888,179],function(){return e(e.s=62433)}),_N_E=e.O()}]);