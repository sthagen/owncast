(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7095],{62433:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/chat/messages",function(){return s(65207)}])},20449:function(e,t,s){"use strict";s.d(t,{e:function(){return m}});var a=s(85893),n=s(56697),l=s(65400),r=s(5152),i=s.n(r),o=s(81453);let d=i()(()=>Promise.resolve().then(s.t.bind(s,42461,23)),{loadableGenerated:{webpack:()=>[42461]},ssr:!1}),c=i()(()=>s.e(1538).then(s.t.bind(s,11538,23)),{loadableGenerated:{webpack:()=>[11538]},ssr:!1}),u=i()(()=>s.e(6773).then(s.t.bind(s,6773,23)),{loadableGenerated:{webpack:()=>[6773]},ssr:!1}),m=e=>{let{user:t,isEnabled:s,label:r,onClick:i}=e;async function m(e){let{id:t}=e;try{let e=await (0,o.rQ)(o.NM,{data:{userId:t,enabled:!s},method:"POST",auth:!0});return e.success}catch(e){console.error(e)}return!1}let h=s?"ban":"unban",b=s?(0,a.jsx)(d,{style:{color:"var(--ant-error)"}}):(0,a.jsx)(c,{style:{color:"var(--ant-warning)"}}),x=(0,a.jsxs)(a.Fragment,{children:["Are you sure you want to ",h," ",(0,a.jsx)("strong",{children:t.displayName}),s?" and remove their messages?":"?"]});return(0,a.jsx)(l.default,{type:"primary",onClick:()=>{n.default.confirm({title:"Confirm ".concat(h),content:x,onCancel:()=>{},onOk:()=>new Promise((e,s)=>{let a=m(t);a?setTimeout(()=>{e(a),null==i||i()},3e3):s()}),okType:"danger",okText:s?"Absolutely":null,icon:b})},size:"small",icon:s?(0,a.jsx)(u,{twoToneColor:"#ff4d4f"}):null,className:"block-user-button",children:r||h})};m.defaultProps={label:"",onClick:null}},14840:function(e,t,s){"use strict";s.d(t,{Z:function(){return A}});var a=s(85893),n=s(67294),l=s(74253),r=s(56697),i=s(53740),o=s(55673),d=s(5789),c=s(74048),u=s(94055),m=s(45938),h=s(58091),b=s(44908),x=s.n(b),p=s(20449),j=s(65400),f=s(5152),g=s.n(f),w=s(81453);let y=g()(()=>Promise.resolve().then(s.t.bind(s,42461,23)),{loadableGenerated:{webpack:()=>[42461]},ssr:!1}),k=g()(()=>s.e(1538).then(s.t.bind(s,11538,23)),{loadableGenerated:{webpack:()=>[11538]},ssr:!1}),v=g()(()=>s.e(6773).then(s.t.bind(s,6773,23)),{loadableGenerated:{webpack:()=>[6773]},ssr:!1}),N=g()(()=>s.e(4612).then(s.t.bind(s,64612,23)),{loadableGenerated:{webpack:()=>[64612]},ssr:!1}),T=e=>{var t;let{user:s,onClick:n}=e;async function l(e,t){let{id:s}=e;try{let e=await (0,w.rQ)(w.jr,{data:{userId:s,isModerator:t},method:"POST",auth:!0});return e.success}catch(e){console.error(e)}return!1}let i=null===(t=s.scopes)||void 0===t?void 0:t.includes("MODERATOR"),o=i?"remove moderator":"add moderator",d=i?(0,a.jsx)(y,{style:{color:"var(--ant-error)"}}):(0,a.jsx)(k,{style:{color:"var(--ant-warning)"}}),c=(0,a.jsxs)(a.Fragment,{children:["Are you sure you want to ",o," ",(0,a.jsx)("strong",{children:s.displayName}),"?"]});return(0,a.jsx)(j.default,{type:"primary",onClick:()=>{r.default.confirm({title:"Confirm ".concat(o),content:c,onCancel:()=>{},onOk:()=>new Promise((e,t)=>{let a=l(s,!i);a?setTimeout(()=>{e(a),null==n||n()},3e3):t()}),okType:"danger",okText:i?"Yup!":null,icon:d})},size:"small",icon:i?(0,a.jsx)(v,{twoToneColor:"#ff4d4f"}):(0,a.jsx)(N,{twoToneColor:"#22bb44"}),className:"block-user-button",children:o})};T.defaultProps={onClick:null};var C=s(53736),P=s(37135);let A=e=>{let{user:t,connectionInfo:s,children:b}=e,[j,f]=(0,n.useState)(!1),g=()=>{f(!1)},{displayName:w,createdAt:y,previousNames:k,nameChangedAt:v,disabledAt:N}=t,{connectedAt:A,messageCount:D,userAgent:S}=s||{},O=null,M=k&&[...k];k&&k.length>1&&v&&(O=new Date(v),M.reverse());let E=new Date(y),I=(0,h.Z)(E,"PP pp"),Z=O?(0,m.Z)(O):null;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.default,{title:(0,a.jsxs)(a.Fragment,{children:["Created at: ",I,".",(0,a.jsx)("br",{})," Click for more info."]}),placement:"bottomLeft",children:(0,a.jsx)("button",{type:"button","aria-label":"Display more details about this user",className:"user-item-container",onClick:()=>{f(!0)},children:b})}),(0,a.jsx)(r.default,{destroyOnClose:!0,width:600,cancelText:"Close",okButtonProps:{style:{display:"none"}},title:"User details: ".concat(w),open:j,onOk:g,onCancel:g,children:(0,a.jsxs)("div",{className:"user-details",children:[(0,a.jsx)(i.default.Title,{level:4,children:w}),(0,a.jsxs)("p",{className:"created-at",children:["User created at ",I,"."]}),(0,a.jsxs)(o.Z,{gutter:16,children:[s&&(0,a.jsxs)(d.Z,{md:O?12:24,children:[(0,a.jsx)(i.default.Title,{level:5,children:"This user is currently connected to Chat."}),(0,a.jsxs)("ul",{className:"connection-info",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Active for:"})," ",(0,m.Z)(new Date(A))]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Messages sent:"})," ",D]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"User Agent:"}),(0,a.jsx)("br",{}),(0,P.AB)(S)]})]})]}),O&&(0,a.jsxs)(d.Z,{md:s?12:24,children:[(0,a.jsx)(i.default.Title,{level:5,children:"This user is also seen as:"}),(0,a.jsx)("ul",{className:"previous-names-list",children:x()(M).map((e,t)=>(0,a.jsxs)("li",{className:0===t?"latest":"",children:[(0,a.jsx)("span",{className:"user-name-item",children:e}),0===t?" (Changed ".concat(Z," ago)"):""]}))})]})]}),(0,a.jsx)(l.Z,{}),(0,a.jsxs)(c.default,{direction:"horizontal",children:[N?(0,a.jsxs)(a.Fragment,{children:["This user was banned on ",(0,a.jsx)("code",{children:(0,C.u)(N)}),".",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),(0,a.jsx)(p.e,{label:"Unban this user",user:t,isEnabled:!1,onClick:g})]}):(0,a.jsx)(p.e,{label:"Ban this user",user:t,isEnabled:!0,onClick:g}),(0,a.jsx)(T,{user:t,onClick:g})]})]})})]})};A.defaultProps={connectionInfo:null}},53736:function(e,t,s){"use strict";s.d(t,{K:function(){return d},u:function(){return o}});var a=s(85893),n=s(2307),l=s(58091),r=s(14840),i=s(20449);function o(e){let t=new Date(e);return t.getFullYear()!==new Date().getFullYear()?(0,l.Z)(new Date(e),"MMM d, yyyy H:mma"):(0,l.Z)(new Date(e),"MMM d H:mma")}let d=e=>{let{data:t}=e,s=[{title:"Last Known Display Name",dataIndex:"displayName",key:"displayName",render:(e,t)=>(0,a.jsx)(r.Z,{user:t,children:(0,a.jsx)("span",{className:"display-name",children:e})})},{title:"Created",dataIndex:"createdAt",key:"createdAt",render:e=>o(e),sorter:(e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime(),sortDirections:["descend","ascend"]},{title:"Disabled at",dataIndex:"disabledAt",key:"disabledAt",defaultSortOrder:"descend",render:e=>e?o(e):null,sorter:(e,t)=>new Date(e.disabledAt).getTime()-new Date(t.disabledAt).getTime(),sortDirections:["descend","ascend"]},{title:"",key:"block",className:"actions-col",render:(e,t)=>(0,a.jsx)(i.e,{user:t,isEnabled:!t.disabledAt})}];return(0,a.jsx)(n.Z,{pagination:{hideOnSinglePage:!0},className:"table-container",columns:s,dataSource:t,size:"small",rowKey:"id"})}},65207:function(e,t,s){"use strict";s.r(t),s.d(t,{OUTCOME_TIMEOUT:function(){return C},default:function(){return P}});var a=s(85893),n=s(67294),l=s(2307),r=s(53740),i=s(65400),o=s(94184),d=s.n(o),c=s(58091),u=s(5152),m=s.n(u),h=s(81453),b=s(37135),x=s(94055);let p=m()(()=>Promise.resolve().then(s.t.bind(s,29918,23)),{loadableGenerated:{webpack:()=>[29918]},ssr:!1}),j=m()(()=>Promise.resolve().then(s.t.bind(s,84645,23)),{loadableGenerated:{webpack:()=>[84645]},ssr:!1}),f=m()(()=>Promise.resolve().then(s.t.bind(s,37431,23)),{loadableGenerated:{webpack:()=>[37431]},ssr:!1}),g=m()(()=>Promise.resolve().then(s.t.bind(s,42461,23)),{loadableGenerated:{webpack:()=>[42461]},ssr:!1}),w=e=>{let{isVisible:t,message:s,setMessage:l}=e;if(!s||(0,b.Qr)(s))return null;let r=null,[o,d]=(0,n.useState)(0),{id:c}=s||{},u=()=>{r=setTimeout(()=>{d(0)},3e3)};(0,n.useEffect)(()=>()=>{clearTimeout(r)});let m=async()=>{clearTimeout(r),d(0);let e=await (0,h.rQ)(h.hn,{auth:!0,method:"POST",data:{visible:!t,idArray:[c]}});e.success&&"changed"===e.message?(l({...s,visible:!t}),d(1)):(l({...s,visible:t}),d(-1)),u()},w=(0,a.jsx)(f,{style:{color:"transparent"}});return o&&(w=o>0?(0,a.jsx)(f,{style:{color:"var(--ant-success)"}}):(0,a.jsx)(g,{style:{color:"var(--ant-warning)"}})),(0,a.jsxs)("div",{className:"toggle-switch ".concat(t?"":"hidden"),children:[(0,a.jsx)("span",{className:"outcome-icon",children:w}),(0,a.jsx)(x.default,{title:"Click to ".concat(t?"hide":"show"," this message"),placement:"topRight",children:(0,a.jsx)(i.default,{shape:"circle",size:"small",type:"text",icon:t?(0,a.jsx)(p,{}):(0,a.jsx)(j,{}),onClick:m})})]})};var y=s(14840),k=s(34261);let{Title:v}=r.default,N=m()(()=>Promise.resolve().then(s.t.bind(s,37431,23)),{loadableGenerated:{webpack:()=>[37431]},ssr:!1}),T=m()(()=>Promise.resolve().then(s.t.bind(s,42461,23)),{loadableGenerated:{webpack:()=>[42461]},ssr:!1}),C=3e3;function P(){let[e,t]=(0,n.useState)([]),[s,r]=(0,n.useState)([]),[o,u]=(0,n.useState)(!1),[m,x]=(0,n.useState)(null),[p,j]=(0,n.useState)(""),f=null,g=null,k=async()=>{try{let e=await (0,h.rQ)(h.WE,{auth:!0});(0,b.Qr)(e)?t([]):t(e)}catch(e){console.log("==== error",e)}};(0,n.useEffect)(()=>(k(),g=setInterval(()=>{k()},h.NE),()=>{clearTimeout(f),clearTimeout(g)}),[]);let P=function(e){let t=e.reduce((e,t)=>{let s=t.user.id;return e.some(e=>e.text===s)||e.push({text:s,value:s}),e},[]);return t.sort((e,t)=>{let s=e.text.toUpperCase(),a=t.text.toUpperCase();return s<a?-1:s>a?1:0})}(e),A=s=>{let a=e.findIndex(e=>e.id===s.id);e.splice(a,1,s),t([...e])},D=()=>{f=setTimeout(()=>{x(null),j("")},C)},S=async n=>{u(!0);let l=await (0,h.rQ)(h.hn,{auth:!0,method:"POST",data:{visible:n,idArray:s}});if(l.success&&"changed"===l.message){x((0,a.jsx)(N,{})),D();let l=[...e];s.map(t=>{let s=l.findIndex(e=>e.id===t),a={...e[s],visible:n};return l.splice(s,1,a),null}),t(l),r([])}else x((0,a.jsx)(T,{})),D();u(!1)},O=[{title:"Time",dataIndex:"timestamp",key:"timestamp",className:"timestamp-col",defaultSortOrder:"descend",render:e=>{let t=new Date(e);return(0,c.Z)(t,"PP pp")},sorter:(e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime(),width:90},{title:"User",dataIndex:"user",key:"user",className:"name-col",filters:P,onFilter:(e,t)=>t.user.id===e,sorter:(e,t)=>e.user.displayName.localeCompare(t.user.displayName),sortDirections:["ascend","descend"],ellipsis:!0,render:e=>{let{displayName:t}=e;return(0,a.jsx)(y.Z,{user:e,children:t})},width:110},{title:"Message",dataIndex:"body",key:"body",className:"message-col",width:320,render:e=>(0,a.jsx)("div",{className:"message-contents",dangerouslySetInnerHTML:{__html:e}})},{title:"",dataIndex:"hiddenAt",key:"hiddenAt",className:"toggle-col",filters:[{text:"Visible messages",value:!0},{text:"Hidden messages",value:!1}],onFilter:(e,t)=>t.visible===e,render:(e,t)=>(0,a.jsx)(w,{isVisible:!e,message:t,setMessage:A}),width:30}],M=d()({"bulk-editor":!0,active:s.length});return(0,a.jsxs)("div",{className:"chat-messages",children:[(0,a.jsx)(v,{children:"Chat Messages"}),(0,a.jsx)("p",{children:"Manage the messages from viewers that show up on your stream."}),(0,a.jsxs)("div",{className:M,children:[(0,a.jsx)("span",{className:"label",children:"Check multiple messages to change their visibility to: "}),(0,a.jsx)(i.default,{type:"primary",size:"small",shape:"round",className:"button",loading:"show"===p&&o,icon:"show"===p&&m,disabled:!s.length||p&&"show"!==p,onClick:()=>{j("show"),S(!0)},children:"Show"}),(0,a.jsx)(i.default,{type:"primary",size:"small",shape:"round",className:"button",loading:"hide"===p&&o,icon:"hide"===p&&m,disabled:!s.length||p&&"hide"!==p,onClick:()=>{j("hide"),S(!1)},children:"Hide"})]}),(0,a.jsx)(l.Z,{size:"small",className:"table-container",pagination:{defaultPageSize:100,showSizeChanger:!0},scroll:{y:540},rowClassName:e=>e.hiddenAt?"hidden":"",dataSource:e,columns:O,rowKey:e=>e.id,rowSelection:{selectedRowKeys:s,onChange:e=>{r(e)}}})]})}P.getLayout=function(e){return(0,a.jsx)(k.l,{page:e})}}},function(e){e.O(0,[5596,1130,4104,9403,1024,3942,971,6697,1664,1749,1700,2122,9552,7752,5891,2891,4749,6627,8966,8091,5938,686,4261,9774,2888,179],function(){return e(e.s=62433)}),_N_E=e.O()}]);