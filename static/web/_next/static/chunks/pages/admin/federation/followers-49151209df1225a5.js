(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2476],{89675:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/federation/followers",function(){return r(35352)}])},35352:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return FediverseFollowers}});var n=r(85893),a=r(67294),l=r(2307),s=r(84960),o=r(65400),i=r(20838),d=r(58091),c=r(5152),u=r.n(c),h=r(3273),m=r(3111),w=r(21119),p=r(90695);let g=u()(()=>r.e(6910).then(r.t.bind(r,66910,23)),{loadableGenerated:{webpack:()=>[66910]},ssr:!1}),x=u()(()=>r.e(6139).then(r.t.bind(r,26139,23)),{loadableGenerated:{webpack:()=>[26139]},ssr:!1}),FollowersTable=e=>{let{data:t,tableColumns:r,totalCount:a,setCurrentPage:s}=e;return(0,n.jsx)(l.Z,{dataSource:t,columns:r,size:"small",rowKey:e=>e.link,pagination:{pageSize:25,hideOnSinglePage:!0,showSizeChanger:!1,total:a},onChange:e=>{let t=e.current;s(t)}})};function FediverseFollowers(){let[e,t]=(0,a.useState)([]),[r,c]=(0,a.useState)([]),[u,p]=(0,a.useState)([]),[f,k]=(0,a.useState)(0),[j,y]=(0,a.useState)(0),F=(0,a.useContext)(h.a),{serverConfig:b}=F||{},{federation:v}=b,{isPrivate:S}=v,getFollowers=async()=>{try{let e="".concat(m.HP,"?offset=").concat(25*j,"&limit=").concat(25),n=await (0,m.rQ)(e,{auth:!0}),{results:a,total:l}=n;(0,w.Qr)(a)?p([]):(k(l),p(a));let s=await (0,m.rQ)(m.E8,{auth:!0});(0,w.Qr)(s)?t([]):t(s);let o=await (0,m.rQ)(m.Y9,{auth:!0});(0,w.Qr)(r)?c([]):c(o)}catch(e){console.log("==== error",e)}};(0,a.useEffect)(()=>{getFollowers()},[]);let T=[{title:"",dataIndex:"image",key:"image",width:90,render:e=>(0,n.jsx)(s.ZP,{size:40,src:e||"/img/logo.svg"})},{title:"Name",dataIndex:"name",key:"name",render:(e,t)=>(0,n.jsx)("a",{href:t.link,target:"_blank",rel:"noreferrer",children:t.name||t.username})},{title:"URL",dataIndex:"link",key:"link",render:(e,t)=>(0,n.jsx)("a",{href:t.link,target:"_blank",rel:"noreferrer",children:t.link})}];async function approveFollowRequest(e){try{await (0,m.rQ)(m.kb,{auth:!0,method:"POST",data:{actorIRI:e.link,approved:!0}}),getFollowers()}catch(e){console.error(e)}}async function rejectFollowRequest(e){try{await (0,m.rQ)(m.kb,{auth:!0,method:"POST",data:{actorIRI:e.link,approved:!1}}),getFollowers()}catch(e){console.error(e)}}let D=[...T];D.unshift({title:"Approve",dataIndex:null,key:null,render:e=>(0,n.jsx)(o.default,{type:"primary",icon:(0,n.jsx)(g,{}),onClick:()=>{approveFollowRequest(e)}}),width:50},{title:"Reject",dataIndex:null,key:null,render:e=>(0,n.jsx)(o.default,{type:"primary",danger:!0,icon:(0,n.jsx)(x,{}),onClick:()=>{rejectFollowRequest(e)}}),width:50}),D.push({title:"Requested",dataIndex:"timestamp",key:"requested",width:200,render:e=>{let t=new Date(e);return(0,n.jsx)(n.Fragment,{children:(0,d.Z)(t,"P")})},sorter:(e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime(),sortDirections:["descend","ascend"],defaultSortOrder:"descend"});let _=[...T];_.unshift({title:"Approve",dataIndex:null,key:null,render:e=>(0,n.jsx)(o.default,{type:"primary",icon:(0,n.jsx)(g,{}),size:"large",onClick:()=>{approveFollowRequest(e)}}),width:50}),_.push({title:"Requested",dataIndex:"timestamp",key:"requested",width:200,render:e=>{let t=new Date(e);return(0,n.jsx)(n.Fragment,{children:(0,d.Z)(t,"P")})},sorter:(e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime(),sortDirections:["descend","ascend"],defaultSortOrder:"descend"},{title:"Rejected/Blocked",dataIndex:"timestamp",key:"disabled_at",width:200,render:e=>{let t=new Date(e);return(0,n.jsx)(n.Fragment,{children:(0,d.Z)(t,"P")})},sorter:(e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime(),sortDirections:["descend","ascend"],defaultSortOrder:"descend"});let I=[...T];I.push({title:"Added",dataIndex:"timestamp",key:"timestamp",width:200,render:e=>{let t=new Date(e);return(0,n.jsx)(n.Fragment,{children:(0,d.Z)(t,"P")})},sorter:(e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime(),sortDirections:["descend","ascend"],defaultSortOrder:"descend"},{title:"Remove",dataIndex:null,key:null,render:e=>(0,n.jsx)(o.default,{type:"primary",danger:!0,icon:(0,n.jsx)(x,{}),onClick:()=>{rejectFollowRequest(e)}}),width:50});let R=(0,n.jsxs)("span",{children:["Followers ",f>0&&"(".concat(f,")")]}),q=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{children:"The following accounts get notified when you go live or send a post."}),(0,n.jsx)(FollowersTable,{data:u,tableColumns:I,totalCount:f,setCurrentPage:y})]}),C=(0,n.jsxs)("span",{children:["Requests ",e.length>0&&"(".concat(e.length,")")]}),P=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{children:["The following people are requesting to follow your Owncast server on the"," ",(0,n.jsx)("a",{href:"https://en.wikipedia.org/wiki/Fediverse",target:"_blank",rel:"noopener noreferrer",children:"Fediverse"})," ","and be alerted to when you go live. Each must be approved."]}),(0,n.jsx)(l.Z,{dataSource:e,columns:D,size:"small",rowKey:e=>e.link})]}),O=(0,n.jsxs)("span",{children:["Blocked ",r.length>0&&"(".concat(r.length,")")]}),E=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{children:"The following people were either rejected or blocked by you. You can approve them as a follower."}),(0,n.jsx)("p",{children:(0,n.jsx)(l.Z,{dataSource:r,columns:_,size:"small",rowKey:e=>e.link})})]});return(0,n.jsx)("div",{className:"followers-section",children:(0,n.jsx)(i.default,{defaultActiveKey:"1",items:[{label:R,key:"1",children:q},S&&{label:C,key:"2",children:P},{label:O,key:"3",children:E}]})})}FediverseFollowers.getLayout=function(e){return(0,n.jsx)(p.l,{page:e})}}},function(e){e.O(0,[5596,1130,4104,9403,1024,3942,971,6697,1664,1749,2122,7752,5891,2891,4749,6627,8966,3068,8091,1051,695,9774,2888,179],function(){return e(e.s=89675)}),_N_E=e.O()}]);